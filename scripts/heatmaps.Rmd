Analysis of Data for Acromegaly Patients by Heatmaps
=============================================================

Statistics
----------

```{r data-entry, echo=FALSE}
#load in the previously processed and annoted acromegaly analysis results
analysis.file <- "../data/processed/Annotated DESeq Results - Acromegaly.csv"
analysis.data <- read.csv(analysis.file)
transcripts.file <- "../data/processed/Normalized Counts Table.csv"
transcript.counts <- read.csv(transcripts.file, row.names="X")
#set the conditions
mapping <- read.csv("../data/raw/patient_sample_mapping.csv")
mapping$samplename <- paste("sample", mapping$sample.., sep="")
mapping$group <- relevel(mapping$group, ref="non-functioning")
levels(mapping$group) <- c("Control", "Acromegaly","Cushing's")

#subset out differentially expressed transcripts
diff.transcripts <- droplevels(subset(analysis.data, padj <= 0.05))
```
This file was most recently processed on ```r date()```.  This uses the genes which were subsetted (only the highest 40\%).  Also, this uses the DESeq normalized data.


Differentially Expressed Genes
----------------------------------

```{r de-heatmap, dev=c('png','pdf'), echo=FALSE, fig.show='asis'}
mapping.filtered <- subset(mapping, samplename != 'sample12128')
#removed cushings samples
filtered.transcript.counts <- droplevels(transcript.counts[,subset(mapping.filtered, group != "Cushing's")$samplename])

#subset for differenially expressed transcripts
differential.transcripts <- diff.transcripts$id
diff.exprs <- filtered.transcript.counts[as.character(differential.transcripts),]
#reordered based on fold change
ordered.transcripts <- diff.transcripts[order(diff.transcripts$foldChange),]
diff.exprs.ordered <- diff.exprs[as.character(ordered.transcripts$id),]
#show only unique genes
diff.exprs.ordered.genes <- diff.exprs.ordered[!(duplicated(ordered.transcripts$external_gene_id, incomparables=F)),]
rownames(diff.exprs.ordered.genes) <- as.character(ordered.transcripts[!(duplicated(ordered.transcripts$external_gene_id, incomparables=F)),]$external_gene_id)


library(gplots,quietly=TRUE)
library(RColorBrewer,quietly=TRUE)
bars <- brewer.pal(2, "Set1")
color.map <- function(x) { if (x=="Acromegaly") bars[1] else bars[2] }

mapping.acromegaly <- subset(mapping.filtered, group != "Cushing's")
diagnosis.colors <- sapply(mapping.acromegaly[order(match(mapping.acromegaly$samplename,colnames(diff.exprs))),]$group, FUN=color.map)

plot(as.dendrogram(hclust(dist(t(scale(as.matrix(diff.exprs.ordered)))))))
heatmap.colors <- brewer.pal(11, "BrBG")
heatmap.2(log(as.matrix(diff.exprs.ordered.genes)+1), scale="row", Rowv=F, ColSideColors=diagnosis.colors, col=heatmap.colors, density.info="none", trace="none", labCol=F, margins=c(6,6))

#write it out to a final figure as well
pdf('../figures/differential-expressor-heatmap.pdf')
heatmap.colors <- brewer.pal(11, "BrBG")
heatmap.2(log(as.matrix(diff.exprs.ordered.genes)+1), scale="row", Rowv=F, ColSideColors=diagnosis.colors, col=heatmap.colors, density.info="none", trace="none", labCol=F, margins=c(6,6))
dev.off()
```

Session Information
-------------------
```{r session-info}
sessionInfo()
```
